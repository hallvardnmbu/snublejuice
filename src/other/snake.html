<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Snake</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        display: flex;
        /*justify-content: center;*/
      }
    </style>
  </head>
  <body>
    <canvas id="canvasGame" width="320" height="200"></canvas>

    <script>
      let ctx = document.getElementById("canvasGame").getContext("2d");

      let cellSize = 10;
      let worldWidth = ctx.canvas.width / cellSize;
      let worldHeight = ctx.canvas.height / cellSize;

      class SnakeBodyPart {
        x;
        y;
        color;

        constructor(x, y, color) {
          this.x = x;
          this.y = y;
          this.color = color;
        }
      }

      let gameStarted = false;
      let gameOver = false;
      let highScore = 0;

      let snake = [];
      let head = new SnakeBodyPart(
        Math.floor(worldWidth / 2),
        Math.floor(worldHeight / 2),
        "green",
      );
      snake.push(head);

      let snakeDirection = { x: 0, y: 0 };

      let food = {
        x: 0,
        y: 0,
        symbol: "üéÑ",
      };

      let foodSymbols = ["üéÑ", "ü§∂", "üéÅ", "‚ùÑÔ∏è", "‚òÉÔ∏è"];

      document.onkeydown = function (e) {
        if (!gameStarted && e.key === " ") {
          gameStarted = true;
          return;
        }

        if (gameOver && e.key === " ") {
          snake = [];
          snakeDirection = { x: 0, y: 0 };
          gameOver = false;
          gameStarted = true;

          let head = new SnakeBodyPart(
            Math.floor(worldWidth / 2),
            Math.floor(worldHeight / 2),
            "green",
          );
          snake.push(head);

          food.x = Math.floor(Math.random() * worldWidth);
          food.y = Math.floor(Math.random() * worldHeight);
          food.symbol =
            foodSymbols[Math.floor(Math.random() * foodSymbols.length)];

          return;
        }

        snakeDirection.x = 0;
        snakeDirection.y = 0;

        if (e.key === "ArrowLeft") {
          snakeDirection.x = -1;
        } else if (e.key === "ArrowRight") {
          snakeDirection.x = 1;
        } else if (e.key === "ArrowUp") {
          snakeDirection.y = -1;
        } else if (e.key === "ArrowDown") {
          snakeDirection.y = 1;
        }
      };

      function drawIntro() {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);

        ctx.fillStyle = "white";
        ctx.font = "40px Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText("SNAKE", ctx.canvas.width / 2, ctx.canvas.height / 2 - 40);

        ctx.font = "20px Arial";
        ctx.fillText(
          "Trykk SPACE for √• starte",
          ctx.canvas.width / 2,
          ctx.canvas.height / 2 + 20,
        );

        ctx.fillText(
          "Highscore: " + highScore,
          ctx.canvas.width / 2,
          ctx.canvas.height / 2 + 50,
        );
      }

      function drawGameOver() {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);

        ctx.fillStyle = "red";
        ctx.font = "40px Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(
          "DU D√òDE",
          ctx.canvas.width / 2,
          ctx.canvas.height / 2 - 40,
        );

        ctx.font = "20px Arial";
        ctx.fillStyle = "white";
        ctx.fillText(
          "Lengde: " + snake.length,
          ctx.canvas.width / 2,
          ctx.canvas.height / 2,
        );

        ctx.fillText(
          "Highscore: " + highScore,
          ctx.canvas.width / 2,
          ctx.canvas.height / 2 + 20,
        );

        ctx.fillText(
          "Trykk SPACE for √• starte p√• nytt",
          ctx.canvas.width / 2,
          ctx.canvas.height / 2 + 40,
        );
      }

      function drawGrid() {
        ctx.strokeStyle = "rgba(178, 39, 39, 0.4)";
        ctx.lineWidth = 1;

        for (let x = 0; x <= ctx.canvas.width; x += cellSize) {
          ctx.beginPath();
          ctx.moveTo(x, 0);
          ctx.lineTo(x, ctx.canvas.height);
          ctx.stroke();
        }

        for (let y = 0; y <= ctx.canvas.height; y += cellSize) {
          ctx.beginPath();
          ctx.moveTo(0, y);
          ctx.lineTo(ctx.canvas.width, y);
          ctx.stroke();
        }
      }

      function game() {
        if (!gameStarted) {
          drawIntro();
          return;
        }

        if (gameOver) {
          drawGameOver();
          return;
        }

        // Flytt kroppen
        for (let p = snake.length - 1; p > 0; p--) {
          snake[p].x = snake[p - 1].x;
          snake[p].y = snake[p - 1].y;
        }

        // Flytt hodet
        snake[0].x += snakeDirection.x;
        snake[0].y += snakeDirection.y;

        // üíÄ D√òR HVIS DU TREFFER VEGGEN
        if (
          snake[0].x < 0 ||
          snake[0].x >= worldWidth ||
          snake[0].y < 0 ||
          snake[0].y >= worldHeight
        ) {
          if (snake.length > highScore) highScore = snake.length;
          gameOver = true;
          return;
        }

        // Sjekk kollisjon med egen kropp
        for (let i = 1; i < snake.length; i++) {
          if (snake[0].x === snake[i].x && snake[0].y === snake[i].y) {
            if (snake.length > highScore) highScore = snake.length;
            gameOver = true;
            return;
          }
        }

        // Spiser mat
        if (snake[0].x === food.x && snake[0].y === food.y) {
          let last = snake[snake.length - 1];
          let newPart = new SnakeBodyPart(last.x, last.y, "red");
          snake.push(newPart);

          food.x = Math.floor(Math.random() * worldWidth);
          food.y = Math.floor(Math.random() * worldHeight);
          food.symbol =
            foodSymbols[Math.floor(Math.random() * foodSymbols.length)];
        }

        // Tegn
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        drawGrid();

        // Tegn mat
        ctx.fillStyle = "yellow";
        ctx.font = cellSize * 2.5 + "px Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(
          food.symbol,
          food.x * cellSize + cellSize / 2,
          food.y * cellSize + cellSize / 2,
        );

        // Tegn slange
        for (let i = 0; i < snake.length; i++) {
          ctx.fillStyle = snake[i].color;
          ctx.fillRect(
            snake[i].x * cellSize,
            snake[i].y * cellSize,
            cellSize,
            cellSize,
          );
        }
      }

      setInterval(game, 100);
    </script>
  </body>
</html>
